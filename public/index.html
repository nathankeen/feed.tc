<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atom Feed Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        .article {
            border-bottom: 1px solid #ccc;
            padding: 10px 0;
        }
        .article h3 {
            margin: 0;
        }
        .article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Latest Article from The Conversation (Tonic Media Network)</h1>
    <div id="feed"></div>

    <script>
async function fetchFeed() {
    try {
        // Change 'localhost' to your server URL
        const response = await fetch('https://tc-atom-app-f3k6o.ondigitalocean.app/get-feed');
        
        // Debugging: Log the fetched feed
        const text = await response.text();
        console.log("Fetched Feed Data:", text);  // Check what is being fetched from the server

        // Parse the XML data
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "application/xml");

        // Check if there are any XML parsing errors
        const errorNode = xml.querySelector('parsererror');
        if (errorNode) {
            console.error('Error parsing XML:', errorNode);
            document.getElementById("feed").innerHTML = "<p>Error parsing feed.</p>";
            return;
        }

        // Extract the first article (entry) from the Atom feed
        const entry = xml.querySelector("entry");
        if (!entry) {
            document.getElementById("feed").innerHTML = "<p>No articles available.</p>";
            return;
        }

        // Extract details like title, link, and summary
        const title = entry.querySelector("title").textContent;
        const link = entry.querySelector("link").getAttribute("href");
        const summary = entry.querySelector("summary")?.textContent || "No summary available.";
        
        let media = "";
        const mediaElements = entry.getElementsByTagName("media:content");
        if (mediaElements.length > 0) {
            media = mediaElements[0].getAttribute("url");
        }

        // Create an article element and add it to the page
        const article = document.createElement("div");
        article.classList.add("article");
        article.innerHTML = `
            <h3><a href="${link}" target="_blank">${title}</a></h3>
            <p>${summary}</p>
            ${media ? `<img src="${media}" alt="Article Image">` : ""}
        `;
        document.getElementById("feed").appendChild(article);

    } catch (error) {
        console.error("Error fetching the feed:", error);
        document.getElementById("feed").innerHTML = "<p>Failed to load feed.</p>";
    }
}
</script>

// Call the function when the page loads
fetchFeed();

</body>
</html>
